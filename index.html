<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Merge Axolotls!</title>
<!-- Crypto-JS for encryption -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-align: center;
    background: linear-gradient(135deg, #e0f7fa, #c5cae9);
    color: #333;
    padding: 20px;
    margin: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
      margin-bottom: 5px;
  }
  #gameArea {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    flex-wrap: wrap;
    gap: 20px;
  }
  #stats {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(5px);
    padding: 10px 20px;
    margin-bottom: 20px;
    border-radius: 20px;
    display: inline-block;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    font-size: 1.2em;
    font-weight: bold;
  }
  #grid {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    grid-gap: 12px;
    justify-content: center;
    margin-bottom: 20px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(5px);
    border-radius: 20px;
    box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1);
  }
  #nameInputContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(5px);
    padding: 15px;
    border-radius: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  #nameInputContainer label {
    font-size: 1.1em;
    font-weight: bold;
    color: #444;
  }
  #nameInputContainer input {
    padding: 8px;
    width: 120px;
    margin-top: 10px;
    border-radius: 10px;
    border: 2px solid #aaa;
    text-align: center;
    font-size: 1em;
  }
  .cell {
    width: 100px;
    height: 100px;
    background: white;
    border: 3px solid #6c7e97;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 12px;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  .cell:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
  }
  .cell.selected {
      border: 3px solid #ff4d4d;
  }
  .axolotl-svg {
    width: 50px;
    height: 50px;
  }
  button {
    display: block;
    width: 300px;
    margin: 15px auto;
    padding: 12px 20px;
    font-size: 1.1em;
    font-weight: bold;
    border-radius: 25px;
    border: none;
    cursor: pointer;
    color: white;
    background-size: 200% auto;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  }
  .buy-axolotl {
    background-image: linear-gradient(to right, #6a11cb 0%, #2575fc 50%, #6a11cb 100%);
  }
  .buy-ingot {
    background-image: linear-gradient(to right, #ff7e5f 0%, #feb47b 50%, #ff7e5f 100%);
  }
  .buy-auto-merge {
    background-image: linear-gradient(to right, #e87b28 0%, #d85c15 50%, #e87b28 100%);
  }
  .expand-grid {
    background-image: linear-gradient(to right, #00c6ff 0%, #0072ff 50%, #00c6ff 100%);
  }
  .save-load-btn {
    background-image: linear-gradient(to right, #11998e 0%, #38ef7d 50%, #11998e 100%);
  }
  .reset-btn {
    background-image: linear-gradient(to right, #ff416c 0%, #ff4b2b 50%, #ff416c 100%);
  }
  .discord-btn {
    background-image: linear-gradient(to right, #5865F2 0%, #7289DA 50%, #5865F2 100%);
  }
  .prestige-btn {
    background-image: linear-gradient(to right, #7b4397 0%, #dc2430 50%, #7b4397 100%);
  }
  button:hover {
    background-position: right center;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
  }
  button:disabled {
    background-image: linear-gradient(to right, #c0c0c0 0%, #a0a0a0 50%, #c0c0c0 100%);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    transform: translateY(0);
    cursor: not-allowed;
  }
  
  .button-group {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 10px;
  }
  .button-group button {
      width: 200px;
      margin: 0;
  }
  #save-load-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 20px;
  }

  /* New save feedback message */
  #saveFeedback {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 15px;
      border-radius: 10px;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      pointer-events: none;
      font-size: 1em;
  }
  #saveFeedback.visible {
      opacity: 1;
  }
  #modalOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
  }
  #modalContent {
      background: #fff;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      text-align: center;
      width: 90%;
      max-width: 500px;
  }
  #modalContent input, #modalContent label {
      width: 80%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
  }
  #modalContent button {
      width: auto;
      margin: 5px;
  }
</style>
</head>
<body>

<h1>Merge Axolotls!</h1>
<div id="stats">
  Coins: <span id="coins">0</span> |
  Passive Income: <span id="income">0</span>/sec |
  ðŸª™ <span id="ingots">0</span> |
  âœ¨ Multiplier: <span id="multiplierDisplay">1x coins, 1x ingots</span>
</div>

<div id="gameArea">
  <div id="grid"></div>
  <div id="nameInputContainer">
    <label for="axolotlNameInput">Name Axolotls</label>
    <input type="text" id="axolotlNameInput" maxlength="7" placeholder="Name">
  </div>
</div>

<button id="buyAxolotlBtn" class="buy-axolotl" onclick="buyAxolotl()">Buy Lvl 1 Axolotl (10 Coins)</button>
<div class="button-group">
  <button id="buyIngotBtn" class="buy-ingot" onclick="buyIngot()">Buy Gold Ingot (1000 Coins)</button>
  <button id="buy10IngotsBtn" class="buy-ingot" onclick="buy10Ingots()">Buy 10 Ingots (9750 Coins)</button>
  <button id="buy100IngotsBtn" class="buy-ingot" onclick="buy100Ingots()">Buy 100 Ingots (95000 Coins)</button>
</div>
<button id="expandGridBtn" class="expand-grid" onclick="expandGrid()">Expand Grid</button>
<button id="autoMergeBtn" class="buy-auto-merge" onclick="buyAutoMerge()">Buy Auto Merge Lvl 1 (1000 Ingots)</button>
<button id="prestigeBtn" class="prestige-btn" onclick="showModal('prestige')">Prestige (1M Coins)</button>

<h3>Socials & Settings</h3>
<button class="discord-btn" onclick="window.open('https://discord.gg/HhSK2VsvP5', '_blank')">Join my Discord server!</button>
<div id="save-load-group">
    <h4>Copy/Paste Save ID</h4>
    <button id="copySaveBtn" class="save-load-btn" onclick="copySaveData()">Copy Save ID</button>
    <button class="save-load-btn" onclick="showModal('import')">Import Save ID</button>
</div>
<button class="reset-btn" onclick="resetGame()">Reset Game</button>

<div id="saveFeedback">Game Saved!</div>

<!-- Combined Modal Container -->
<div id="modalContainer" style="display:none;">
    <div id="modalOverlay">
        <div id="modalContent">
            <!-- Content will be dynamically added here -->
        </div>
    </div>
</div>

<script>
  const AES_KEY = "super-secret-key-that-is-not-very-secret";
  const colors = ["#4CAF50", "#2196F3", "#FF9800", "#9C27B0", "#E91E63", "#FFEB3B", "#00BCD4", "#795548", "#8BC34A", "#F44336"];
  let gridSize = 3;
  let grid = new Array(gridSize * gridSize).fill(0);
  let coins = 0;
  let ingots = 0;
  let selected = null;
  let axolotlName = "";
  let autoMergeLevel = 0;
  let autoMergeInterval = null;
  const maxPassive = 5000;
  let consentGiven = false;
  let autoSaveInterval = null;
  // Prestige-related variables
  let prestigeBought = false;
  let ingotGainMultiplier = 1;
  let coinGainMultiplier = 1;

  const cost_axolotl = 10;
  const cost_ingot = 1000;
  const cost_10_ingots = 9750;
  const cost_100_ingots = 95000;
  const expand_costs = { 3: 100, 4: 500 };
  const autoMerge_costs = [1000, 2000, 5000];
  const prestige_cost = 1000000;
  const prestige_ingot_bonus = 5;
  const prestige_coin_bonus = 2;

  const gridDiv = document.getElementById('grid');
  const coinsSpan = document.getElementById('coins');
  const incomeSpan = document.getElementById('income');
  const ingotsSpan = document.getElementById('ingots');
  const multiplierDisplay = document.getElementById('multiplierDisplay');
  const axolotlNameInput = document.getElementById("axolotlNameInput");
  const buyAxolotlBtn = document.getElementById('buyAxolotlBtn');
  const buyIngotBtn = document.getElementById('buyIngotBtn');
  const buy10IngotsBtn = document.getElementById('buy10IngotsBtn');
  const buy100IngotsBtn = document.getElementById('buy100IngotsBtn');
  const expandGridBtn = document.getElementById('expandGridBtn');
  const autoMergeBtn = document.getElementById('autoMergeBtn');
  const prestigeBtn = document.getElementById('prestigeBtn');
  const saveFeedback = document.getElementById('saveFeedback');
  const modalContainer = document.getElementById('modalContainer');
  const modalContent = document.getElementById('modalContent');

  axolotlNameInput.addEventListener("input", e => {
    axolotlName = e.target.value.slice(0,7);
    renderGrid();
    if (consentGiven) saveToLocalStorage();
  });

  // Helper function to format numbers with K and M
  function formatNumber(num) {
      if (num >= 1000000) {
          return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
      }
      if (num >= 1000) {
          return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K';
      }
      return num;
  }

  function getAxolotlSVG(color) {
    return `
      <svg class="axolotl-svg" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
        <circle cx="32" cy="32" r="16" fill="${color}" stroke="black" stroke-width="2"/>
        <line x1="16" y1="32" x2="0" y2="32" stroke="black" stroke-width="2"/>
        <line x1="48" y1="32" x2="64" y2="32" stroke="black" stroke-width="2"/>
        <circle cx="26" cy="28" r="3" fill="black"/>
        <circle cx="38" cy="28" r="3" fill="black"/>
        <path d="M26 38 Q32 46 38 38" stroke="black" stroke-width="2" fill="none"/>
      </svg>`;
  }

  function renderGrid() {
    gridDiv.style.gridTemplateColumns = `repeat(${gridSize}, 100px)`;
    gridDiv.innerHTML = '';
    grid.forEach((level, idx) => {
      const cell = document.createElement('div');
      cell.className = 'cell';
      if (level > 0) {
        let color = colors[(level - 1) % colors.length];
        cell.innerHTML = getAxolotlSVG(color) + `<div>${axolotlName}-${level}</div>`;
      }
      cell.onclick = () => selectCell(idx, cell);
      gridDiv.appendChild(cell);
    });
    if (selected !== null) {
        gridDiv.children[selected].classList.add("selected");
    }
  }

  function selectCell(idx, cell) {
    if (grid[idx] === 0) return;
    if (selected === null) {
      selected = idx;
      cell.classList.add("selected");
    } else if (selected !== idx && grid[selected] === grid[idx]) {
      grid[selected]++;
      coins += grid[selected] * coinGainMultiplier;
      grid[idx] = 0;
      selected = null;
      updateIncome();
      renderGrid();
      updateDisplay();
      if (consentGiven) saveToLocalStorage();
    } else {
      selected = null;
      renderGrid();
    }
  }

  function buyAxolotl() {
    if (coins >= cost_axolotl) {
      coins -= cost_axolotl;
      let empty = grid.map((v,i)=>v===0?i:-1).filter(i=>i!==-1);
      if (empty.length > 0) {
        const randomIndex = Math.floor(Math.random() * empty.length);
        grid[empty[randomIndex]] = 1;
        updateIncome();
        renderGrid();
        updateDisplay();
        if (consentGiven) saveToLocalStorage();
      } else {
        showDialog("No empty space on the grid!");
        coins += cost_axolotl;
      }
    } else showDialog("Not enough coins to buy Axolotl");
  }

  function buyIngot() {
    if (coins >= cost_ingot) {
      coins -= cost_ingot;
      ingots += 1 * ingotGainMultiplier;
      updateDisplay();
      if (consentGiven) saveToLocalStorage();
    } else showDialog("Not enough coins to buy Ingot");
  }
  function buy10Ingots() {
    if (coins >= cost_10_ingots) {
      coins -= cost_10_ingots;
      ingots += 10 * ingotGainMultiplier;
      updateDisplay();
      if (consentGiven) saveToLocalStorage();
    } else showDialog("Not enough coins to buy 10 Ingots");
  }
  function buy100Ingots() {
    if (coins >= cost_100_ingots) {
      coins -= cost_100_ingots;
      ingots += 100 * ingotGainMultiplier;
      updateDisplay();
      if (consentGiven) saveToLocalStorage();
    } else showDialog("Not enough coins to buy 100 Ingots");
  }

  function expandGrid() {
    const currentCost = expand_costs[gridSize];
    if (gridSize < 5 && ingots >= currentCost) {
      ingots -= currentCost;
      gridSize++;
      grid = grid.concat(new Array(gridSize * gridSize - grid.length).fill(0));
      updateIncome();
      renderGrid();
      updateDisplay();
      if (consentGiven) saveToLocalStorage();
    } else if (gridSize >= 5) {
        showDialog("Grid is already at max size.");
    } else {
        showDialog("Not enough ingots to expand grid");
    }
  }

  function buyAutoMerge() {
    if (autoMergeLevel >= 3) return;
    const cost = autoMerge_costs[autoMergeLevel];
    if (ingots >= cost) {
      ingots -= cost;
      autoMergeLevel++;
      if (autoMergeInterval) clearInterval(autoMergeInterval);
      const times = [5000, 3000, 1000];
      autoMergeInterval = setInterval(runAutoMerge, times[autoMergeLevel - 1]);
      updateAutoMergeButton();
      updateDisplay();
      if (consentGiven) saveToLocalStorage();
    } else showDialog(`Not enough ingots to buy Auto Merge Lvl ${autoMergeLevel + 1}`);
  }

  function updateAutoMergeButton() {
    if (autoMergeLevel < 3) {
      autoMergeBtn.textContent = `Buy Auto Merge Lvl ${autoMergeLevel + 1} (${formatNumber(autoMerge_costs[autoMergeLevel])} Ingots)`;
      autoMergeBtn.style.display = "block";
    } else {
      autoMergeBtn.style.display = "none";
    }
  }

  function runAutoMerge() {
    if (coins >= 10 && grid.includes(0)) {
      coins -= 10;
      let empty = grid.map((v,i)=>v===0?i:-1).filter(i=>i!==-1);
      if (empty.length > 0) {
        const randomIndex = Math.floor(Math.random() * empty.length);
        grid[empty[randomIndex]] = 1;
      }
    }
    if (autoMergeLevel >= 1) mergeAllOfLevel(1);
    if (autoMergeLevel >= 2) mergeAllOfLevel(2);
    if (autoMergeLevel >= 3) { mergeAllOfLevel(3); mergeAllOfLevel(4); }
    updateIncome();
    renderGrid();
    updateDisplay();
    if (consentGiven) saveToLocalStorage();
  }

  function mergeAllOfLevel(level) {
    let merged = true;
    while (merged) {
      merged = false;
      const indices = grid.map((v, i) => v === level ? i : -1).filter(i => i !== -1);
      if (indices.length >= 2) {
        const first = indices[0];
        const second = indices[1];
        grid[first]++;
        coins += grid[first] * coinGainMultiplier;
        grid[second] = 0;
        merged = true;
      }
    }
  }

  function prestige() {
    if (prestigeBought) {
        showDialog("You have already prestiged! This can only be done once.");
        return;
    }
    prestigeBought = true;
    ingotGainMultiplier = prestige_ingot_bonus;
    coinGainMultiplier = prestige_coin_bonus;

    gridSize = 3;
    grid = new Array(gridSize * gridSize).fill(0);
    coins = 50;
    selected = null;
    axolotlName = "";
    autoMergeLevel = 0;
    if (autoMergeInterval) clearInterval(autoMergeInterval);
    updateAutoMergeButton();
    updateIncome();
    renderGrid();
    updateDisplay();
    if (consentGiven) saveToLocalStorage();
    hideModal();
    showDialog(`You have prestiged! Your passive income is now multiplied by ${coinGainMultiplier}x and your ingot gain by ${ingotGainMultiplier}x.`);
  }

  function updateIncome() {
    let income = grid.reduce((acc,v)=>acc+(v>0?Math.pow(2,v):0),0);
    if (income > maxPassive) income = maxPassive;
    incomeSpan.textContent = formatNumber(Math.floor(income * coinGainMultiplier));
  }

  function updateDisplay() {
    coinsSpan.textContent = formatNumber(coins);
    ingotsSpan.textContent = formatNumber(ingots);
    multiplierDisplay.textContent = `${coinGainMultiplier}x coins, ${ingotGainMultiplier}x ingots`;

    buyAxolotlBtn.disabled = coins < cost_axolotl;
    buyIngotBtn.disabled = coins < cost_ingot;
    buy10IngotsBtn.disabled = coins < cost_10_ingots;
    buy100IngotsBtn.disabled = coins < cost_100_ingots;

    if (gridSize < 5) {
        expandGridBtn.disabled = ingots < expand_costs[gridSize];
        expandGridBtn.textContent = `Expand Grid (${formatNumber(expand_costs[gridSize])} Ingots)`;
    } else {
        expandGridBtn.disabled = true;
        expandGridBtn.textContent = "Grid Fully Expanded";
    }

    if (autoMergeLevel < 3) {
      autoMergeBtn.disabled = ingots < autoMerge_costs[autoMergeLevel];
    }
    
    if (prestigeBought) {
        prestigeBtn.disabled = true;
        prestigeBtn.textContent = "Prestige Complete";
    } else {
        prestigeBtn.disabled = coins < prestige_cost;
    }
  }

  function passiveIncomeLoop() {
    let income = grid.reduce((acc, v) => acc + (v > 0 ? Math.pow(2, v) : 0), 0);
    if (income > maxPassive) income = maxPassive;
    coins += Math.floor(income * coinGainMultiplier);
    updateDisplay();
  }
  setInterval(passiveIncomeLoop, 1000);

  let feedbackTimeout;
  function showSaveFeedback(message) {
    clearTimeout(feedbackTimeout);
    saveFeedback.textContent = message;
    saveFeedback.classList.add('visible');
    feedbackTimeout = setTimeout(() => {
        saveFeedback.classList.remove('visible');
    }, 2000);
  }

  function showDialog(message) {
      modalContent.innerHTML = `
          <h2>Message</h2>
          <p>${message}</p>
          <button class="reset-btn" onclick="hideModal()">Close</button>
      `;
      modalContainer.style.display = 'flex';
  }
  
  function hideModal() {
    modalContainer.style.display = 'none';
  }

  function showModal(type) {
      if (type === 'import') {
          modalContent.innerHTML = `
              <h2>Import Save Data</h2>
              <p>Paste your save ID below:</p>
              <input type="text" id="importInput" placeholder="Paste your save ID here">
              <button class="save-load-btn" onclick="importSaveId()">Import</button>
              <button class="reset-btn" onclick="hideModal()">Cancel</button>
          `;
      } else if (type === 'consent') {
          modalContent.innerHTML = `
              <h2>Cookie Consent</h2>
              <p>Do you accept cookies (local storage save)? This will allow your game to save automatically on your device and remembers your progress on this browser.</p>
              <button class="save-load-btn" onclick="acceptCookies()">Accept</button>
              <button class="reset-btn" onclick="startWithoutCookies()">Decline</button>
          `;
      } else if (type === 'prestige') {
          if (prestigeBought) {
              modalContent.innerHTML = `
                  <h2>Prestige Complete</h2>
                  <p>You have already prestiged. This can only be done once!</p>
                  <button class="reset-btn" onclick="hideModal()">Close</button>
              `;
          } else {
              modalContent.innerHTML = `
                  <h2>Prestige</h2>
                  <p>Are you sure you want to Prestige? This action costs ${formatNumber(prestige_cost)} coins and is irreversible. You will get permanent multipliers for your next playthrough.</p>
                  <p>Upon prestiging, you will get **${prestige_coin_bonus}x coins** and **${prestige_ingot_bonus}x ingots** forever!</p>
                  <button class="prestige-btn" onclick="prestige()">Prestige Now</button>
                  <button class="reset-btn" onclick="hideModal()">Cancel</button>
              `;
          }
      }
      modalContainer.style.display = 'flex';
  }

  // Local storage functions, only called if consent is given
  function saveToLocalStorage() {
      const saveObject = {
          grid,
          coins,
          ingots,
          gridSize,
          autoMergeLevel,
          axolotlName,
          prestigeBought,
          ingotGainMultiplier,
          coinGainMultiplier
      };
      const saveData = JSON.stringify(saveObject);
      const encryptedData = CryptoJS.AES.encrypt(saveData, AES_KEY).toString();
      localStorage.setItem("axolotlSave", encryptedData);
  }

  function loadFromLocalStorage() {
      const save = localStorage.getItem("axolotlSave");
      if (save) {
          try {
              const decryptedData = CryptoJS.AES.decrypt(save, AES_KEY).toString(CryptoJS.enc.Utf8);
              const data = JSON.parse(decryptedData);
              applyGameData(data);
          } catch (e) {
              console.error("Failed to parse save data:", e);
              showDialog("Error loading game. Save data might be corrupted. Starting new game.");
              applyGameData({});
          }
      } else {
          applyGameData({});
      }
  }

  function applyGameData(data) {
      grid = data.grid || new Array(3*3).fill(0);
      coins = data.coins || 50;
      ingots = data.ingots || 0;
      gridSize = data.gridSize || 3;
      autoMergeLevel = data.autoMergeLevel || 0;
      axolotlName = data.axolotlName || "";
      prestigeBought = data.prestigeBought || false;
      ingotGainMultiplier = data.ingotGainMultiplier || 1;
      coinGainMultiplier = data.coinGainMultiplier || 1;

      if (autoMergeInterval) clearInterval(autoMergeInterval);
      if (autoMergeLevel > 0) {
          const times = [5000, 3000, 1000];
          autoMergeInterval = setInterval(runAutoMerge, times[autoMergeLevel - 1]);
      }
      axolotlNameInput.value = axolotlName;
      updateAutoMergeButton();
      renderGrid();
      updateIncome();
      updateDisplay();
  }

  function resetGame() {
      showDialog(`Are you sure you want to reset your game? This will remove all progress (including ingots and prestige bonuses).
      <br><br>
      <button class="reset-btn" onclick="performReset()">Yes, Reset</button>
      <button class="save-load-btn" onclick="hideModal()">Cancel</button>`);
  }

  function performReset() {
      localStorage.removeItem("axolotlSave");
      localStorage.removeItem("consentGiven");
      location.reload();
  }

  function getGameState() {
      return {
          grid,
          coins,
          ingots,
          gridSize,
          autoMergeLevel,
          axolotlName,
          prestigeBought,
          ingotGainMultiplier,
          coinGainMultiplier
      };
  }

  function importSaveId() {
      const saveData = document.getElementById('importInput').value;
      if (!saveData) {
          showDialog("Please paste a valid save ID.");
          return;
      }
      try {
          const decryptedData = CryptoJS.AES.decrypt(saveData, AES_KEY).toString(CryptoJS.enc.Utf8);
          const data = JSON.parse(decryptedData);
          applyGameData(data);
          if (consentGiven) saveToLocalStorage();
          hideModal();
          showSaveFeedback("Game imported successfully!");
      } catch (e) {
          console.error("Error importing data:", e);
          showDialog("Invalid save ID. Failed to import game progress.");
      }
  }

  function copySaveData() {
      const gameState = getGameState();
      const saveData = JSON.stringify(gameState);
      const encryptedData = CryptoJS.AES.encrypt(saveData, AES_KEY).toString();

      const tempInput = document.createElement('textarea');
      tempInput.value = encryptedData;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);
      showSaveFeedback("Save ID copied to clipboard!");
  }

  function acceptCookies() {
    consentGiven = true;
    localStorage.setItem("consentGiven", "true");
    hideModal();
    loadFromLocalStorage(); // Load from local storage after accepting
    if (autoSaveInterval) clearInterval(autoSaveInterval);
    autoSaveInterval = setInterval(saveToLocalStorage, 5000);
  }

  function startWithoutCookies() {
    consentGiven = false;
    hideModal();
    applyGameData({}); // Start a fresh game without local storage
  }

  window.onload = () => {
    const savedConsent = localStorage.getItem("consentGiven");
    if (savedConsent === "true") {
      consentGiven = true;
      loadFromLocalStorage();
      autoSaveInterval = setInterval(saveToLocalStorage, 5000);
    } else if (savedConsent === null) {
      // Show modal on first-time load
      showModal('consent');
      applyGameData({}); // Start a new game behind the modal
    } else { // savedConsent === "false"
      consentGiven = false;
      applyGameData({});
    }
    setInterval(passiveIncomeLoop, 1000);
  }

</script>
</body>
</html>
